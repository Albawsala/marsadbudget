tinymce.PluginManager.add('imagemanager',function(editor)
{
	var win;

	function openmanager()
	{
		win = editor.windowManager.open(
		{
			title: 'Images',
			url: url_base+'images?editor='+editor.id,
			width: 792,
			height: 480
		});
	}
	
	window.addEventListener("message", function(event)
	{
		if(event.data.editor == editor.id)
		{
			win.close();
			editor.insertContent('<img src="'+ event.data.url +'"/>');
		}
	});

	editor.addButton(
		'imagemanager',
		{
			icon: 'image',
			tooltip: 'Insert Image',
			onclick: openmanager,
			stateSelector: 'img:not([data-mce-object])'
		}
	);
});
